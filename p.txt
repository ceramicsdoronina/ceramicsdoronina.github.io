<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script>
    // --- Consent state (persistito) ---
    const CONSENT_KEY = "cd_cookie_consent_v1";
    function getConsent() {
      try { return JSON.parse(localStorage.getItem(CONSENT_KEY) || "{}"); }
      catch { return {}; }
    }
    function setConsent(obj) {
      localStorage.setItem(CONSENT_KEY, JSON.stringify(obj || {}));
    }
  
    // --- Lazy loaders (caricati SOLO dopo consenso) ---
    function loadScriptOnce(id, src) {
      if (document.getElementById(id)) return;
      const s = document.createElement("script");
      s.id = id;
      s.async = true;
      s.src = src;
      document.head.appendChild(s);
    }
  
    function enableGoogleAnalytics() {
      // carica gtag solo dopo consenso
      loadScriptOnce("ga-gtag", "https://www.googletagmanager.com/gtag/js?id=G-CK9T9455XR");
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = gtag;
      gtag("js", new Date());
      gtag("config", "G-CK9T9455XR", { anonymize_ip: true });
    }
  
    function enableMetaPixel() {
      // carica pixel solo dopo consenso
      if (window.fbq) return;
      !function(f,b,e,v,n,t,s){
        if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)
      }(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
  
      fbq("init", "1422337862632630");
      fbq("track", "PageView");
    }
  
    // Avvio automatico se già accettato in passato
    document.addEventListener("DOMContentLoaded", () => {
      const c = getConsent();
      if (c.analytics) enableGoogleAnalytics();
      if (c.marketing) enableMetaPixel();
    });
  </script>


  <title>Ceramics Doronina · Stripe</title>

  <!-- SheetJS (per ODS) -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

  <!-- Stili principali (riuso gli stessi del sito) -->
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/catalogue.css">
  <link rel="stylesheet" href="css/pages.css">
  <link rel="stylesheet" href="css/mobile.css">

  <!-- Override Stripe (solo se serve) -->
  <link rel="stylesheet" href="Stripe/css/stripe.css">
</head>
<body>
  <div id="cookie-banner" style="position:fixed; left:0; right:0; bottom:0; z-index:999999;
    background:white; border-top:1px solid #e5e5e5; padding:14px 16px; display:none;">
    <div style="max-width:1200px; margin:0 auto; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
      <div style="flex:1; min-width:260px;">
        Questo sito usa cookie per statistiche (Google Analytics) e marketing (Meta Pixel).
        <a href="/cookie-policy.html" target="_blank" rel="noopener">Cookie policy</a>
        ·
        <a href="/privacy-policy.html" target="_blank" rel="noopener">Privacy policy</a>
      </div>
      <button id="cookie-reject" style="padding:10px 12px; border:1px solid #111; background:#fff; cursor:pointer;">
        Rifiuta
      </button>
      <button id="cookie-accept" style="padding:10px 12px; border:1px solid #7d0f0f; background:#7d0f0f; color:#fff; cursor:pointer;">
        Accetta
      </button>
    </div>
  </div>
  
  <script>
    (function(){
      const CONSENT_KEY = "cd_cookie_consent_v1";
      function getConsent() {
        try { return JSON.parse(localStorage.getItem(CONSENT_KEY) || "{}"); }
        catch { return {}; }
      }
      function setConsent(obj) {
        localStorage.setItem(CONSENT_KEY, JSON.stringify(obj || {}));
      }
  
      const banner = document.getElementById("cookie-banner");
      const btnA = document.getElementById("cookie-accept");
      const btnR = document.getElementById("cookie-reject");
  
      const c = getConsent();
      if (!c || (c.analytics == null && c.marketing == null)) {
        banner.style.display = "block";
      }
  
      btnA.addEventListener("click", () => {
        // qui: “Accetta tutto” (analytics + marketing)
        setConsent({ analytics: true, marketing: true, ts: Date.now() });
        banner.style.display = "none";
        if (window.enableGoogleAnalytics) window.enableGoogleAnalytics();
        if (window.enableMetaPixel) window.enableMetaPixel();
      });
  
      btnR.addEventListener("click", () => {
        // rifiuto totale
        setConsent({ analytics: false, marketing: false, ts: Date.now() });
        banner.style.display = "none";
      });
    })();
  </script>

  <!-- Navbar -->
  <div id="import-navbar"></div>

  <main>
    <div id="import-hero"></div>
    <div id="import-about"></div>
    <div id="import-catalogue"></div>
    <div id="import-workshops"></div>
    <div id="import-giftcards"></div>
    <div id="import-contact"></div>
  </main>

  <div id="import-modals"></div>
  <div id="import-footer"></div>
  <div id="import-view-toggle"></div>

  <!-- CART DRAWER (riuso identico) -->
  <div id="cart-drawer" class="cart-drawer" aria-hidden="true">
    <div class="cart-drawer__panel">
      <div class="cart-drawer__header">
        <div class="cart-drawer__title" data-i18n="cart.title">Cart</div>
        <button id="cart-close-btn" class="cart-drawer__close" type="button" aria-label="Close cart">×</button>
      </div>

      <div id="cart-items" class="cart-drawer__items"></div>

      <div class="cart-drawer__footer">
        <div class="cart-drawer__total">
          <span data-i18n="cart.total">Total</span>
          <span id="cart-total">—</span>
        </div>
        <a id="cart-checkout-btn" class="cart-drawer__checkout" href="#" rel="noopener">
          Checkout
        </a>
      </div>
    </div>
  </div>

  <!-- Dizionario lingue -->
  <script src="messages.js" defer></script>
  <script src="i18n.js" defer></script>

  <!-- Versioni Stripe (non toccano Shopify) -->
  <script src="Stripe/js/catalogueStripe.js" defer></script>
  <script src="masterclass.js" defer></script>
  <script src="certificati.js" defer></script>
  <script src="Stripe/js/uiStripe.js" defer></script>
  <script src="Stripe/js/appStripe.js" defer></script>
  <script src="Stripe/js/importerStripe.js" defer></script>
</body>
</html>
