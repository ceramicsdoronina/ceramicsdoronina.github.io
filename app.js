// ================================
// MESSAGGI / TRADUZIONI
// ================================
const messages = {
  ru: {
    nav: {
      home: "Главная",
      about: "О бренде",
      catalogue: "Каталог",
      workshops: "Мастер-классы",
      contact: "Контакты"
    },
    hero: {
      tagline: "Тактильная интерьерная керамика с бисерной вышивкой, которая превратит ваш дом в место силы и вдохновения"
    },
    about: {
      title: "О бренде",
      intro1: "Меня зовут Анна, и я создаю интерьерную керамику как объект искусства, который поддерживает, вдохновляет и становится частью вашего личного пространства силы.",
      intro2: "Я верю, что предметы, с которыми мы живём, влияют на наше состояние.",
      btnCatalogue: "Каталог",
      btnWorkshops: "Мастер-классы",
      btnGiftCards: "Подарочные сертификаты",
      text1: "Мои вазы — это не просто формы, а предметы, которые меняют атмосферу дома, заряжают энергией и мотивируют на новое.",
      text2: "В каждой работе — высокотемпературная глина, тактильные текстуры, бисерная вышивка и сочетание несовершенной формы с ощущением роскоши."
    },
    catalogue: {
      title: "Каталог",
      lead: "Каждое изделие — это уникальная эмоция для вашего пространства",
      viewPhotos: "Смотреть фото",
      specTitle: "Характеристики",
      spec: {
        height: "Высота",
        diameter: "Диаметр",
        material: "Материал",
        technique: "Техника",
        finish: "Покрытие"
      }
    },
    cat: {
      v1: {
        name: "Accetto Rosso",
        desc: "Глубокая красная глазурь и выразительная фактура поверхности",
        longDesc: "Ваза «Accetto Rosso» с глубокой красной глазурью и фактурной поверхностью, напоминающей камень и морскую воду."
      },
      v2: {
        name: "Ракушка",
        desc: "Мягкая органичная форма и светлая тактильная глазурь",
        longDesc: "Ваза «Ракушка» с мягкими изгибами и светлой глазурью, напоминающей морскую пену и песок."
      },
      v3: {
        name: "Липия",
        desc: "Утончённый вытянутый силуэт с перламутровыми акцентами",
        longDesc: "Ваза «Липия» с вытянутым силуэтом и мягкими линиями, подчёркивающими перламутровые акценты глазури."
      }
    },
    detail: {
      buy: "КУПИТЬ",
      addToCart: "В КОРЗИНУ",
      description: "Описание",
      characteristics: "Характеристики",
      delivery: "Доставка",
      deliveryText: "Мы отправляем изделия по всему миру. Стоимость и сроки зависят от страны. По запросу возможна индивидуальная упаковка."
    },
    contact: {
      title: "Контакты",
      address: "Адрес мастерской:"
    },
    footer: {
      made: "Сайт создан на GitHub Pages"
    }
  },

  it: {
    nav: {
      home: "Home",
      about: "Il brand",
      catalogue: "Catalogo",
      workshops: "Masterclass",
      contact: "Contatti"
    },
    hero: {
      tagline: "Ceramica tattile da interno con ricami di perle che trasforma la tua casa in un luogo di forza e ispirazione."
    },
    about: {
      title: "Il brand",
      intro1: "Mi chiamo Anna e creo ceramiche d’interni come oggetti d’arte che sostengono, ispirano e diventano parte del tuo spazio personale di forza.",
      intro2: "Credo che gli oggetti con cui viviamo influenzino il nostro stato interiore.",
      btnCatalogue: "Catalogo",
      btnWorkshops: "Masterclass",
      btnGiftCards: "Gift Card",
      text1: "I miei vasi non sono solo forme, ma oggetti che trasformano l’atmosfera della casa, danno energia e motivano al nuovo.",
      text2: "In ogni pezzo ci sono argille ad alta temperatura, texture tattili, ricami di perle e l’unione di forme imperfette con una sensazione di lusso."
    },
    catalogue: {
      title: "Catalogo",
      lead: "Ogni pezzo è un’emozione unica per il tuo spazio.",
      viewPhotos: "Vedi foto",
      specTitle: "Caratteristiche",
      spec: {
        height: "Altezza",
        diameter: "Diametro",
        material: "Materiale",
        technique: "Tecnica",
        finish: "Finitura"
      }
    },
    cat: {
      v1: {
        name: "Accetto Rosso",
        desc: "Smalto rosso profondo e superficie materica.",
        longDesc: "Il vaso «Accetto Rosso» ha una smaltatura rossa profonda e una superficie materica che ricorda la roccia e l’acqua del mare."
      },
      v2: {
        name: "Ракушка",
        desc: "Forma morbida e organica con smalto chiaro e tattile.",
        longDesc: "Il vaso «Ракушка» (Conchiglia) ha curve morbide e uno smalto chiaro che ricorda la schiuma del mare e la sabbia."
      },
      v3: {
        name: "Липия",
        desc: "Silhouette slanciata con accenti madreperlati.",
        longDesc: "Il vaso «Липия» ha una silhouette allungata e linee morbide che mettono in risalto gli accenti madreperlati della smaltatura."
      }
    },
    detail: {
      buy: "Acquista",
      addToCart: "Aggiungi al carrello",
      description: "Descrizione",
      characteristics: "Caratteristiche",
      delivery: "Spedizione",
      deliveryText: "Spediamo in tutto il mondo dalla Liguria (Italia). Costi e tempi dipendono dal Paese; per richieste speciali scrivici via email."
    },
    contact: {
      title: "Contatti",
      address: "Studio:"
    },
    footer: {
      made: "Realizzato con GitHub Pages"
    }
  },

  en: {
    nav: {
      home: "Home",
      about: "About",
      catalogue: "Catalogue",
      workshops: "Workshops",
      contact: "Contact"
    },
    hero: {
      tagline: "Tactile interior ceramics with bead embroidery that turns your home into a place of strength and inspiration."
    },
    about: {
      title: "About the brand",
      intro1: "My name is Anna and I create interior ceramics as art objects that support, inspire, and become part of your personal place of strength.",
      intro2: "I believe that the objects we live with shape our inner state.",
      btnCatalogue: "Catalogue",
      btnWorkshops: "Workshops",
      btnGiftCards: "Gift Cards",
      text1: "My vases are not just shapes, but objects that transform the atmosphere of your home, energise you and motivate you for something new.",
      text2: "Each piece brings together high-temperature clays, tactile textures, bead embroidery and the meeting of imperfect forms with a feeling of quiet luxury."
    },
    catalogue: {
      title: "Catalogue",
      lead: "Each piece is a unique emotion for your space.",
      viewPhotos: "View photos",
      specTitle: "Specifications",
      spec: {
        height: "Height",
        diameter: "Diameter",
        material: "Material",
        technique: "Technique",
        finish: "Finish"
      }
    },
    cat: {
      v1: {
        name: "Accetto Rosso",
        desc: "Deep red glaze and expressive textured surface.",
        longDesc: "The «Accetto Rosso» vase has a deep red glaze and a textured surface that recalls stone and seawater."
      },
      v2: {
        name: "Ракушка",
        desc: "Soft organic shape with light tactile glaze.",
        longDesc: "The «Ракушка» (Shell) vase has gentle curves and a pale glaze reminiscent of sea foam and sand."
      },
      v3: {
        name: "Липия",
        desc: "Slender silhouette with pearly accents.",
        longDesc: "The «Липия» vase has an elongated silhouette and soft lines highlighting the pearly accents of the glaze."
      }
    },
    detail: {
      buy: "Buy",
      addToCart: "Add to cart",
      description: "Description",
      characteristics: "Characteristics",
      delivery: "Shipping",
      deliveryText: "We ship worldwide from Liguria (Italy). Costs and delivery times depend on destination; for special requests, please contact us by email."
    },
    contact: {
      title: "Contact",
      address: "Studio address:"
    },
    footer: {
      made: "Made with GitHub Pages"
    }
  }
};

// ================================
// FUNZIONE DI TRADUZIONE
// ================================
function applyTranslations(lang) {
  const dict = messages[lang] || messages.ru;

  document.querySelectorAll("[data-i18n]").forEach(el => {
    const path = el.getAttribute("data-i18n").split(".");
    let cur = dict;
    for (const p of path) {
      if (cur && Object.prototype.hasOwnProperty.call(cur, p)) {
        cur = cur[p];
      } else {
        cur = null;
        break;
      }
    }
    if (typeof cur === "string") {
      el.textContent = cur;
    }
  });
}

// ================================
// GESTIONE LINGUA
// ================================
function getInitialLang() {
  const stored = localStorage.getItem("lang");
  if (stored && messages[stored]) return stored;

  const browser = (navigator.language || "ru").slice(0,2);
  if (messages[browser]) return browser;

  return "ru";
}

function setLang(lang) {
  if (!messages[lang]) lang = "ru";
  localStorage.setItem("lang", lang);
  document.documentElement.lang = lang;
  const select = document.getElementById("language-selector");
  if (select) select.value = lang;
  applyTranslations(lang);
}

// ================================
// VIEW MODE (DESKTOP / MOBILE)
// ================================
function initViewToggle() {
  const btn = document.getElementById("view-toggle-btn");
  if (!btn) return;

  // se schermo piccolo, partiamo con mobile-view
  if (window.innerWidth <= 768) {
    document.body.classList.add("mobile-view");
    btn.textContent = "Desktop";
  } else {
    btn.textContent = "Mobile";
  }

  btn.addEventListener("click", () => {
    document.body.classList.toggle("mobile-view");
    const mobileOn = document.body.classList.contains("mobile-view");
    btn.textContent = mobileOn ? "Desktop" : "Mobile";
  });
}

// ================================
// MODAL + GALLERIA
// ================================
function openModal(modal) {
  if (!modal) return;
  modal.classList.add("open");

  // reset gallery al primo slide
  const main = modal.querySelector(".modal-gallery-main");
  if (main) {
    const slides = Array.from(main.querySelectorAll("img[data-slide]"));
    if (slides.length) {
      slides.forEach((img,i)=> img.classList.toggle("active", i === 0));
      const counter = modal.querySelector("[data-gallery-counter]");
      if (counter) counter.textContent = `1 / ${slides.length}`;
    }
  }
}

function closeModal(modal) {
  if (!modal) return;
  modal.classList.remove("open");
}

function initModals() {
  // aperture (click su media-grid o bottone)
  document.querySelectorAll("[data-modal-target]").forEach(el => {
    el.addEventListener("click", () => {
      const id = el.getAttribute("data-modal-target");
      const modal = document.getElementById(id);
      openModal(modal);
    });
  });

  // chiusura (x)
  document.querySelectorAll("[data-modal-close]").forEach(btn => {
    btn.addEventListener("click", () => {
      const modal = btn.closest(".modal");
      closeModal(modal);
    });
  });

  // chiusura cliccando fuori dal dialog
  document.querySelectorAll(".modal").forEach(modal => {
    modal.addEventListener("click", (e) => {
      if (e.target === modal) {
        closeModal(modal);
      }
    });
  });

  // gallerie
  document.querySelectorAll(".modal").forEach(modal => {
    const main = modal.querySelector(".modal-gallery-main");
    if (!main) return;
    const slides = Array.from(main.querySelectorAll("img[data-slide]"));
    if (!slides.length) return;

    let index = 0;
    const counter = modal.querySelector("[data-gallery-counter]");
    const update = () => {
      slides.forEach((img,i) => img.classList.toggle("active", i === index));
      if (counter) counter.textContent = `${index+1} / ${slides.length}`;
    };
    update();

    const prev = modal.querySelector("[data-gallery-prev]");
    const next = modal.querySelector("[data-gallery-next]");

    if (prev) {
      prev.addEventListener("click", () => {
        index = (index - 1 + slides.length) % slides.length;
        update();
      });
    }
    if (next) {
      next.addEventListener("click", () => {
        index = (index + 1) % slides.length;
        update();
      });
    }
  });
}

// ================================
// ACCORDION
// ================================
function initAccordion() {
  document.querySelectorAll(".accordion").forEach(acc => {
    const headers = acc.querySelectorAll(".accordion-header");
    headers.forEach(header => {
      header.addEventListener("click", () => {
        const panel = header.nextElementSibling;
        if (!panel) return;

        const isActive = panel.classList.contains("active");

        // chiudi tutti
        acc.querySelectorAll(".accordion-panel").forEach(p => p.classList.remove("active"));

        // apri solo se non era già attivo
        if (!isActive) {
          panel.classList.add("active");
        }
      });
    });
  });
}

// ================================
// INIT
// ================================
document.addEventListener("DOMContentLoaded", () => {
  const lang = getInitialLang();
  setLang(lang);

  const selector = document.getElementById("language-selector");
  if (selector) {
    selector.addEventListener("change", (e) => {
      setLang(e.target.value);
    });
  }

  // footer year
  const yearSpan = document.getElementById("year");
  if (yearSpan) yearSpan.textContent = new Date().getFullYear();

  initViewToggle();
  initModals();
  initAccordion();
});
